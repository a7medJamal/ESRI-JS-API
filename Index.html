<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://js.arcgis.com/4.4"></script>
    <link rel="styleSheet" href="https://js.arcgis.com/4.4/esri/css/main.css">
    <title>esri api tutorial</title>
</head>

<body>
    <select id="lstServices"></select>
    <table>
        <tr>
            <td valign=top>
                <div id="toc">
                   
                </div>
            </td>

            <td>
                <div id="mapView" style="width:1000px;height:800px">Map Goes here</div>
            </td>
        </tr>
    </table>


    <div id="buttons"></div>

    <script>
        let mapview;
        let map;
        let layer;


        require(['esri/Map', 'esri/views/MapView' ,
                'esri/request', 'esri/layers/MapImageLayer',
            'esri/widgets/Legend'],
            function (Map, MapView, Request, MapLayer, Legend) {

                generateBaseMaps();

                map = new Map({ basemap: 'streets' });

                var viewOptions = {
                    container: "mapView", map: map, zoom: 12,
                    center: [43.96727678803782, 26.33388770532939]
                };

                mapview = new MapView(viewOptions);

                // this only to add legend
                let legend = new Legend({ view: mapview });
                mapview.ui.add(legend, "bottom-left");


                //this to get all services in arcserver API
                let Url = 'https://sampleserver6.arcgisonline.com/arcgis/rest/services?f=pjson';
                let options = { responseType: "json" };
                Request(Url, options).then(populateMapServices);


                //populate the drop downlist of map services
                function populateMapServices(response) {
                    let result = response.data;
                    let lstServices = document.getElementById("lstServices");

                    //set event listener onChange
                    lstServices.addEventListener("change", onChangeServiceMap);
                    // this to add all services from url to selectbox
                    for (var i = 0; i < result.services.length; i++) {
                        let option = document.createElement("option");
                        option.textContent = result.services[i].name;
                        lstServices.appendChild(option);
                        // alert(result.services[i].name)
                    }
                }
                //on change service Map
                function onChangeServiceMap() {

                    let selectService = lstServices
                        .options[lstServices.selectedIndex].textContent;

                    //add a layer
                    layer = new MapLayer({ url: "https://sampleserver6.arcgisonline.com/arcgis/rest/services/" + selectService + "/MapServer" });
                    map.removeAll();
                    map.add(layer);
                    //wait until the layer is loaded
                    layer.then(() => {

                        //this code to generate table of content (visible & not visible)
                        let toc = document.getElementById("toc");
                        toc.innerHTML = "";

                        let layerList = document.createElement("ul");
                        toc.appendChild(layerList);

                        //populate layer in list
                        populateLayer(layer, layerList);

                        mapview.goTo(layer.fullExtent)

                    })

                }

            })



        // populate layer in the input element
        function populateLayer(thislayer, layerList) {
            for (let i = 0; i < thislayer.sublayers.length; i++) {
                let sublayer = thislayer.sublayers.items[i];

                let chk = document.createElement("input");
                chk.type = "checkbox";
                chk.value = sublayer.id;

                chk.checked = sublayer.visible;

                chk.addEventListener("click", function (e) {
                    let clickedlayer = thislayer.findSublayerById(Number(e.target.value));
                    clickedlayer.visible = e.target.checked
                })


                let lbl = document.createElement("label");
                lbl.textContent = sublayer.title;

                let layerItem = document.createElement("li");
                layerItem.appendChild(chk);
                layerItem.appendChild(lbl);
                layerList.appendChild(layerItem);

            }
        }


        //generate alots of button of basemaps
        function generateBaseMaps() {
            let basemaps = [];
            //  <!-- Unable to find basemap definition for: test. Try one of these:
            //   "streets", "satellite", "hybrid", "terrain", "topo", "gray", "dark-gray", "oceans", 
            //   "national-geographic", "osm", "dark-gray-vector", "gray-vector", "streets-vector", 
            //   "topo-vector", "streets-night-vector", "streets-relief-vector", "streets-navigation-vector" -->
            basemaps.push("satellite");
            basemaps.push("hybrid");
            basemaps.push("topo");
            basemaps.push("oceans");
            basemaps.push("terrain");
            basemaps.push("osm");
            basemaps.push("national-geographic");
            basemaps.push("streets-night-vector");

            //generate multi basemap on the fly
            let setBaseMap = e => map.basemap = e.target.id;
            for (let i = 0; i < basemaps.length; i++) {
                let buttons = document.getElementById("buttons");
                let button = document.createElement("button");
                button.id = basemaps[i];
                button.textContent = basemaps[i];
                button.addEventListener("click", setBaseMap)
                buttons.appendChild(button);

            }
        }
    </script>
</body>

</html>


<!-- 
    if you need to check how many layer in ever layer and another important sample code
layer.sublayers.length
2
layer.sublayers.items[0].sublayers.lenght
1
map.layers.items[0].sublayers._items[0].title
"Damage to Residential Buildings"
map.layers.items[0].sublayers.length
1
map.layers.items[0].findSublayerById(0).title
"No Permit"
map.layers.items[0].findSublayerById(0).visible=false
false
map.layers.items[0].findSublayerById(0).visible=true
true
-->