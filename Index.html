<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://js.arcgis.com/4.4"></script>
    <link rel="styleSheet" href="https://js.arcgis.com/4.4/esri/css/main.css">
    <title>esri api tutorial</title>
</head>

<body>
    <select id="lstServices"></select>
    <div id="mapView" style="width:1000px;height:800px">Map Goes here</div>
    <div id="buttons"></div>

    <script>
        let mapview;
        let map;
        let layer;
        let basemaps = [];
        basemaps.push("satellite");
        basemaps.push("hybrid");
        basemaps.push("topo");
        basemaps.push("oceans");
        basemaps.push("terrain");
        basemaps.push("osm");
        basemaps.push("national-geographic");

        let setBaseMap = e => map.basemap = e.target.id;

        for (let i = 0; i < basemaps.length; i++) {
            let buttons = document.getElementById("buttons");
            let button = document.createElement("button");
            button.id = basemaps[i];
            button.textContent = basemaps[i];
            button.addEventListener("click", setBaseMap)
            buttons.appendChild(button);

        }
        require(['esri/Map', 'esri/views/MapView'
            , 'esri/request', 'esri/layers/MapImageLayer',
            'esri/widgets/Legend'],
            function (Map, MapView, Request, MapLayer, Legend) {

                map = new Map({ basemap: 'streets' });

                var viewOptions = {
                    container: "mapView", map: map, zoom: 12,
                    center: [43.96727678803782, 26.33388770532939]
                };

                mapview = new MapView(viewOptions);

                let legend = new Legend({ view: mapview });
                mapview.ui.add(legend, "bottom-left");


                let Url = 'http://localhost:6080/arcgis/rest/services?f=pjson';


                let options = { responseType: "json" };
                Request(Url, options)
                    .then(function (response) {
                        let result = response.data;
                        let lstServices = document.getElementById("lstServices");

                        lstServices.addEventListener("change", function () {
                            let selectService = lstServices
                                .options[lstServices.selectedIndex].textContent;

                            //add a layer
                            layer = new MapLayer({ url: "http://localhost:6080/arcgis/rest/services/" + selectService + "/MapServer" });
                            map.removeAll();
                            map.add(layer);
                            layer.then(function () {
                                mapview.goTo(layer.fullExtent);
                            })

                        })

                        for (var i = 0; i < result.services.length; i++) {
                            let option = document.createElement("option");
                            option.textContent = result.services[i].name;
                            lstServices.appendChild(option);
                            // alert(result.services[i].name)
                        }
                    });
            })
    </script>
</body>

</html>


<!-- 
    if you need to check how many layer in ever layer
layer.sublayers.length
2
layer.sublayers._items[0].sublayers.lenght
1
-->

<!-- Unable to find basemap definition for: test. Try one of these: "streets", "satellite", "hybrid", "terrain", "topo", "gray", "dark-gray", "oceans", "national-geographic", "osm", "dark-gray-vector", "gray-vector", "streets-vector", "topo-vector", "streets-night-vector", "streets-relief-vector", "streets-navigation-vector" -->